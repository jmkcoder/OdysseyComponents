import { Meta, Story, Canvas, ArgsTable, Source } from '@storybook/addon-docs';
import DatePickerStories, { Default, Disabled, Required, RangeSelection, WithDateRange, FrenchLocale, MondayStart, DarkTheme, WithEvents, CustomStyled, CustomFormats } from './DatePicker.stories';

<Meta 
  title="Components/Date Picker/Documentation"
  of={DatePickerStories}
  parameters={{
    viewMode: 'docs',
    previewTabs: { 
      canvas: { hidden: true } 
    }
  }}
/>

# Date Picker

<div className="tip-wrapper">
  <span className="tip">Component Status: Stable</span>
</div>

A flexible and customizable date picker component for modern web applications.

## Overview

The Date Picker provides an intuitive and feature-rich interface for date selection. It supports single date selection, date range selection, localization, theming, event indicators, and custom input elements to fit various use cases.

### Key Features

- **Single and Range Selection**: Select either a single date or a date range.
- **Date Restrictions**: Disable specific dates, weekdays, or entire months.
- **Public Holidays**: Mark holidays or unavailable dates programmatically.
- **Range Selection with Available Dates**: Get a list of valid dates in a range, excluding disabled ones.
- **Localization**: Support for multiple languages and regional date formats.
- **Customizable Styling**: Extensive theming capabilities via CSS custom properties.
- **Responsive Design**: Works well on both desktop and mobile devices.
- **Keyboard Accessibility**: Full keyboard navigation support.
- **Event Indicators**: Display event indicators on specific dates.
- **Month and Year Navigation**: Easily navigate between months and years.
- **Slotable Input**: Use custom input elements while maintaining calendar functionality.

## Installation

```bash
npm install @jmkcoder/components
```

## Framework Integration

### Plain HTML

Using the component in plain HTML is straightforward:

```html
<odyssey-date-picker></odyssey-date-picker>
```

### With Date Value

```html
<odyssey-date-picker value="2025-04-22"></odyssey-date-picker>
```

### Date Range Selection

```html
<odyssey-date-picker mode="range" start-date="2025-04-15" end-date="2025-04-22"></odyssey-date-picker>
```

### With Custom Input Element

You can provide your own input element while maintaining the date picker functionality:

```html
<odyssey-date-picker>
  <input type="text" slot="input" class="my-custom-input" placeholder="Select a date">
</odyssey-date-picker>
```

## Examples

### Default Date Picker

A basic date picker with default settings.

<Canvas of={Default} />

### Disabled State

A date picker in a disabled state that doesn't allow user interaction.

<Canvas of={Disabled} />

### Required Field

A date picker marked as a required field.

<Canvas of={Required} />

### Range Selection Mode

Select a date range with start and end dates.

<Canvas of={RangeSelection} />

### With Date Range Limits

A date picker with minimum and maximum selectable dates.

<Canvas of={WithDateRange} />

### French Locale

Date picker with French locale for internationalization.

<Canvas of={FrenchLocale} />

### Week Starting on Monday

Date picker with the week starting on Monday instead of Sunday.

<Canvas of={MondayStart} />

### Dark Theme

Date picker with a dark color theme.

<Canvas of={DarkTheme} />

### With Events

Date picker showing event indicators on specific dates.

<Canvas of={WithEvents} />

### Custom Styled

A date picker with custom styling applied through CSS custom properties.

<Canvas of={CustomStyled} />

### Custom Date Formatting

Use the `format` attribute to customize how dates are displayed in the input field. Try different formats using the controls in the example below.

<Canvas of={CustomFormats} />

> **Tip**: Use the format dropdown in the Controls panel below the example to test different date formats.

## Date Formatting

The Date Picker component provides flexible date formatting options to display dates according to your application's needs or regional preferences.

### Format Patterns

You can customize the date display format by setting the `format` attribute with a pattern string:

```html
<odyssey-date-picker format="MM/dd/yyyy"></odyssey-date-picker>
```

### Format Pattern Tokens

| Token | Description | Example |
|-------|-------------|---------|
| `yyyy` | Full year (4 digits) | 2025 |
| `yy` | Short year (2 digits) | 25 |
| `MM` | Month with leading zero (01-12) | 04 |
| `M` | Month without leading zero (1-12) | 4 |
| `dd` | Day with leading zero (01-31) | 07 |
| `d` | Day without leading zero (1-31) | 7 |
| `EEE` | Short weekday name (locale-dependent) | Mon |
| `EEEE` | Full weekday name (locale-dependent) | Monday |
| `MMM` | Short month name (locale-dependent) | Apr |
| `MMMM` | Full month name (locale-dependent) | April |

### Common Date Formats

Here are some common date formats you can use:

| Format Pattern | Description | Example Output |
|----------------|-------------|----------------|
| `yyyy-MM-dd` | ISO date format (default) | 2025-04-26 |
| `MM/dd/yyyy` | US date format | 04/26/2025 |
| `dd.MM.yyyy` | European date format | 26.04.2025 |
| `dd/MM/yyyy` | UK date format | 26/04/2025 |
| `d MMMM, yyyy` | Long date format | 26 April, 2025 |
| `EEE, MMM d, yyyy` | Weekday format | Sat, Apr 26, 2025 |

### Format and Locale Interaction

When both `format` and `locale` attributes are set, the component will:

1. Use the format pattern for the input field display
2. Use locale-specific names for months and weekdays in the calendar
3. Format relative dates (like "Today") according to the locale

```html
<odyssey-date-picker 
  format="d MMMM, yyyy" 
  locale="fr-FR" 
  value="2025-04-26"
></odyssey-date-picker>
```

This will display "26 avril, 2025" using French month names while maintaining the specified format pattern.

### Programmatic Formatting

You can also format dates programmatically:

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Format a specific date with a custom format
const formattedDate = datePicker.formatDate(new Date(2025, 3, 26), 'EEE, MMM d');
console.log(formattedDate); // "Sat, Apr 26"
```

### Range Formatting

In range mode, the component uses the specified format for both dates with a separator:

```html
<odyssey-date-picker 
  mode="range" 
  format="MM/dd/yyyy"
  start-date="2025-04-15" 
  end-date="2025-04-26"
></odyssey-date-picker>
```

This will display "04/15/2025 - 04/26/2025" in the input field.

## JavaScript API

### Getting the Selected Date

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
const selectedDate = datePicker.getDate();
console.log(selectedDate); // Returns a Date object or null if no date is selected
```

### Setting a Date Programmatically

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Set date to April 22, 2025
datePicker.setDate(new Date(2025, 3, 22)); // Note: Months are zero-based (0 = January)
```

### Working with Date Ranges

```javascript
const datePicker = document.querySelector('odyssey-date-picker[mode="range"]');
// Get the selected range
const dateRange = datePicker.getDateRange();
console.log(dateRange.startDate, dateRange.endDate);

// Set a date range programmatically
datePicker.setDateRange(
  new Date(2025, 3, 15), // April 15, 2025
  new Date(2025, 3, 22)  // April 22, 2025
);

// Get all available dates in the range (excluding disabled dates)
const availableDates = datePicker.getAvailableDatesInRange();
console.log(`Available dates in range: ${availableDates.length}`);
```

### Adding Event Indicators

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Add an event indicator to April 15, 2025
datePicker.addEvent(new Date(2025, 3, 15), 'Meeting');

// Add multiple events
datePicker.addEvent(new Date(2025, 3, 22), 'Deadline');
datePicker.addEvent(new Date(2025, 3, 22), 'Team Lunch');

// Clear events from a date
datePicker.clearEvents(new Date(2025, 3, 15));
```

### Managing Disabled Dates

```javascript
const datePicker = document.querySelector('odyssey-date-picker');

// Disable specific dates (like public holidays)
datePicker.addDisabledDate(new Date(2025, 11, 25), "Christmas Day");
datePicker.addDisabledDate(new Date(2025, 0, 1), "New Year's Day");

// Disable multiple dates at once
const holidays = [
  new Date(2025, 6, 4),   // Independence Day
  new Date(2025, 10, 27), // Thanksgiving
  new Date(2025, 10, 28)  // Day after Thanksgiving
];
datePicker.addDisabledDates(holidays, "Public Holiday");

// Enable a previously disabled date
datePicker.removeDisabledDate(new Date(2025, 10, 28));

// Clear all disabled dates
datePicker.clearDisabledDates();

// Check if a date is disabled
if (datePicker.isDateDisabled(new Date(2025, 11, 25))) {
  console.log("This date is disabled");
}

// Get the reason a date is disabled
const reason = datePicker.getDisabledDateReason(new Date(2025, 11, 25));
console.log(reason); // "Christmas Day"
```

### Disabling Weekdays

```javascript
const datePicker = document.querySelector('odyssey-date-picker');

// Disable weekends (0 = Sunday, 6 = Saturday)
datePicker.disableWeekdays([0, 6]);

// Disable a specific weekday
datePicker.disableWeekday(1); // Disable Mondays

// Enable a previously disabled weekday
datePicker.enableWeekday(0); // Enable Sundays

// Clear all disabled weekdays
datePicker.clearDisabledWeekdays();

// Check if a weekday is disabled
if (datePicker.isWeekdayDisabled(6)) {
  console.log("Saturdays are disabled");
}

// Get all disabled weekdays
const disabledWeekdays = datePicker.getDisabledWeekdays();
console.log(disabledWeekdays); // e.g., [0, 6]
```

### Disabling Months

```javascript
const datePicker = document.querySelector('odyssey-date-picker');

// Disable summer months (June, July, August)
datePicker.disableMonths([5, 6, 7]); // Note: Months are zero-based (0 = January)

// Disable a specific month
datePicker.disableMonth(11); // Disable December

// Enable a previously disabled month
datePicker.enableMonth(5); // Enable June

// Clear all disabled months
datePicker.clearDisabledMonths();

// Check if a month is disabled
if (datePicker.isMonthDisabled(11)) {
  console.log("December is disabled");
}

// Get all disabled months
const disabledMonths = datePicker.getDisabledMonths();
console.log(disabledMonths); // e.g., [5, 6, 7]
```

### Listening for Date Selection Events

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
datePicker.addEventListener('date-change', (event) => {
  console.log('Selected date:', event.detail.date);
});

// For range mode
const rangePicker = document.querySelector('odyssey-date-picker[mode="range"]');
rangePicker.addEventListener('date-change', (event) => {
  console.log('Range start:', event.detail.rangeStart);
  console.log('Range end:', event.detail.rangeEnd);
  
  // Access the available dates in the range (excluding disabled dates)
  console.log('Available dates in range:', event.detail.availableDates);
  
  // Access the available dates as Date objects
  const dateObjects = event.detail.availableDatesObjects;
  console.log(`Number of available dates: ${dateObjects.length}`);
  
  // Process only the valid dates in the range
  dateObjects.forEach(date => {
    // Do something with each available date
    processDate(date);
  });
});
```

## API Reference

### Attributes/Properties

| Property/Attribute    | Type            | Default       | Description                                             |
|-----------------------|-----------------|---------------|---------------------------------------------------------|
| `value`               | `string`        | `''`          | Selected date in ISO format (YYYY-MM-DD)                |
| `mode`                | `string`        | `'single'`    | Selection mode ('single' or 'range')                    |
| `disabled`            | `boolean`       | `false`       | Disables the date picker                                |
| `required`            | `boolean`       | `false`       | Makes the date picker a required field                  |
| `format`              | `string`        | `'yyyy-MM-dd'`| Date format for display                                 |
| `min-date`            | `string`        | `''`          | Minimum selectable date in ISO format                   |
| `max-date`            | `string`        | `''`          | Maximum selectable date in ISO format                   |
| `start-date`          | `string`        | `''`          | Start date for range selection in ISO format            |
| `end-date`            | `string`        | `''`          | End date for range selection in ISO format              |
| `locale`              | `string`        | `'en-US'`     | Locale for date formatting and localization             |
| `first-day-of-week`   | `string`        | `'0'`         | First day of week (0: Sunday, 1: Monday, 6: Saturday)   |
| `theme`               | `string`        | `'light'`     | Theme variant ('light', 'dark', 'minimal', 'high-contrast') |

### Slots

| Slot Name    | Description                                                                     |
|--------------|---------------------------------------------------------------------------------|
| `input`      | Slot for a custom input element (replaces the default input while maintaining the calendar icon and functionality) |

### Methods

| Method                 | Parameters                                    | Return Type    | Description                               |
|------------------------|-----------------------------------------------|----------------|-------------------------------------------|
| `setDate(date)`        | `date: Date`                                  | `void`         | Sets the selected date                     |
| `getDate()`            | -                                             | `Date \| null` | Gets the selected date                     |
| `setDateRange(startDate, endDate)` | `startDate: Date, endDate: Date`  | `void`         | Sets the selected date range               |
| `getDateRange()`       | -                                             | `{startDate: Date \| null, endDate: Date \| null}` | Gets the selected date range |
| `getAvailableDatesInRange()` | -                                       | `Date[]`       | Gets available dates within the selected range, excluding disabled dates |
| `addEvent(date, eventName)`      | `date: Date, eventName: string = 'event'` | `void`  | Adds an event indicator to a specific date |
| `clearEvents(date)`    | `date: Date`                                  | `void`         | Clears event indicators from a specific date |
| `addDisabledDate(date, reason)` | `date: Date, reason?: string` | `void` | Disables a specific date with optional reason |
| `removeDisabledDate(date)` | `date: Date` | `void` | Enables a previously disabled date |
| `addDisabledDates(dates, reason)` | `dates: Date[], reason?: string` | `void` | Disables multiple dates at once with optional shared reason |
| `clearDisabledDates()` | - | `void` | Clears all specifically disabled dates |
| `isDateDisabled(date)` | `date: Date` | `boolean` | Checks if a date is disabled |
| `getDisabledDateReason(date)` | `date: Date` | `string \| null` | Gets the reason a date is disabled or null if not disabled |
| `disableWeekday(weekday)` | `weekday: number` | `void` | Disables a specific weekday (0-6) |
| `enableWeekday(weekday)` | `weekday: number` | `void` | Enables a previously disabled weekday |
| `disableWeekdays(weekdays)` | `weekdays: number[]` | `void` | Disables multiple weekdays at once |
| `clearDisabledWeekdays()` | - | `void` | Clears all disabled weekday settings |
| `isWeekdayDisabled(weekday)` | `weekday: number` | `boolean` | Checks if a weekday is disabled |
| `getDisabledWeekdays()` | - | `number[]` | Gets all currently disabled weekdays |
| `disableMonth(month)` | `month: number` | `void` | Disables a specific month (0-11) |
| `enableMonth(month)` | `month: number` | `void` | Enables a previously disabled month |
| `disableMonths(months)` | `months: number[]` | `void` | Disables multiple months at once |
| `clearDisabledMonths()` | - | `void` | Clears all disabled month settings |
| `isMonthDisabled(month)` | `month: number` | `boolean` | Checks if a month is disabled |
| `getDisabledMonths()` | - | `number[]` | Gets all currently disabled months |

### Events

| Event Name         | Detail Object                                      | Description                                  |
|--------------------|---------------------------------------------------|----------------------------------------------|
| `date-change`      | Single mode: `{date: string}`<br/>Range mode: `{rangeStart: string, rangeEnd: string, availableDates: string[], availableDatesObjects: Date[]}` | Fired when the selected date changes. Range mode includes arrays of available dates (excluding disabled ones) |
| `calendar-open`    | `{}`                                              | Fired when the calendar is opened             |
| `calendar-close`   | `{}`                                              | Fired when the calendar is closed             |
| `date-clear`       | `{}`                                              | Fired when the date selection is cleared      |

### CSS Custom Properties

| Property                              | Default              | Description                                    |
|---------------------------------------|----------------------|------------------------------------------------|
| `--date-picker-primary-color`         | `#4361ee`            | Primary color for selected dates and actions   |
| `--date-picker-text-color`            | `#333`               | Text color                                     |
| `--date-picker-bg-color`              | `#fff`               | Background color                               |
| `--date-picker-border-color`          | `#ddd`               | Border color                                   |
| `--date-picker-today-bg-color`        | `#f0f4ff`            | Background color for today's date             |
| `--date-picker-selected-bg-color`     | `#4361ee`            | Background color for selected date            |
| `--date-picker-selected-text-color`   | `#fff`               | Text color for selected date                  |
| `--date-picker-hover-bg-color`        | `#f5f7fa`            | Background color on hover                     |
| `--date-picker-disabled-text-color`   | `#bbb`               | Text color for disabled dates                 |
| `--date-picker-event-color`           | `#ff6b6b`            | Color for event indicators                    |
| `--date-picker-focus-outline-color`   | `#4361ee`            | Color for focus outline                       |
| `--date-picker-range-bg-color`        | Variable opacity     | Background color for date range               |

## Working with Disabled Dates

The DatePicker component provides comprehensive functionality for controlling date availability.

### Disabling Specific Dates

You can disable specific dates, such as public holidays or unavailable booking dates:

```javascript
// Disable Christmas for the next three years
[2025, 2026, 2027].forEach(year => {
  datePicker.addDisabledDate(new Date(year, 11, 25), "Christmas Day");
});
```

### Disabling Weekends or Specific Weekdays

To limit selection to workdays or specific days of the week:

```javascript
// Disable weekends
datePicker.disableWeekdays([0, 6]); // Sunday and Saturday

// For a booking system that only accepts appointments on certain days
datePicker.disableWeekdays([0, 2, 4, 6]); // Only allow Mon, Wed, Fri
```

### Disabling Entire Months

For seasonal constraints or extended unavailability periods:

```javascript
// Disable winter months
datePicker.disableMonths([11, 0, 1]); // December, January, February

// For a seasonal business that operates only in summer
datePicker.disableMonths([0, 1, 2, 3, 9, 10, 11]); // Only allow May through August
```

### Working with Range Selection

When using range selection with disabled dates, the component provides access to only the valid dates:

```javascript
// When using range selection with weekends disabled
rangePicker.disableWeekdays([0, 6]);

// Listen for date changes
rangePicker.addEventListener('date-change', (event) => {
  // This will only include weekdays, excluding weekends
  const workdays = event.detail.availableDatesObjects;
  
  console.log(`Selected ${workdays.length} working days`);
  
  // Calculate something based on working days only
  calculateWorkHours(workdays.length * 8);
});
```

### Hierarchy of Restrictions

When multiple restriction mechanisms are used, dates are evaluated in this order:
1. Min/max date constraints
2. Disabled weekdays
3. Disabled months
4. Specifically disabled dates

A date is disabled if it fails any of these checks.

## Customizing the Input Element

The Date Picker component provides a flexible way to use your own custom input element while maintaining all the date picker functionality.

### Basic Custom Input Example

```html
<odyssey-date-picker>
  <input type="text" slot="input" class="my-custom-input" placeholder="Choose a date...">
</odyssey-date-picker>
```

### Styling Custom Inputs

You can apply your own styles to the custom input, while the date picker will still handle the date formatting and calendar interactions:

```html
<odyssey-date-picker format="MMM d, yyyy">
  <input type="text" 
         slot="input" 
         class="custom-fancy-input"
         placeholder="Select date...">
</odyssey-date-picker>

<style>
  .custom-fancy-input {
    padding: 10px 15px;
    border: 2px solid #8b5cf6;
    border-radius: 8px;
    font-size: 16px;
    background-color: #f3f4f6;
    transition: all 0.3s ease;
  }
  
  .custom-fancy-input:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
    border-color: #7c3aed;
  }
</style>
```

### Integration with Form Frameworks

When using custom inputs with form libraries or frameworks, note that the date picker will automatically:

1. Set the input to `readonly` to prevent direct typing
2. Handle the date formatting based on the date picker's configuration
3. Maintain calendar icon positioning on the right side of the input

### Accessibility Considerations

When using custom inputs, ensure they have appropriate:
- Labels or aria-labels
- Color contrast ratios
- Focus states for keyboard navigation

The date picker will automatically handle the calendar dialog's accessibility.

## Accessibility

The Date Picker component is built with accessibility in mind, supporting ARIA attributes and keyboard navigation.

### Keyboard Navigation

- **Tab**: Focus on the date picker input field.
- **Space/Enter**: Open the calendar when input is focused.
- **Arrow keys**: Navigate within the calendar grid.
- **Page Up/Down**: Navigate to previous/next month.
- **Home/End**: Navigate to the first/last day of the current month.
- **Escape**: Close the calendar without selection.
- **Enter**: Select the focused date.

### ARIA Attributes

- `role="dialog"` for the calendar popup.
- `aria-label` attributes for navigation buttons.
- `aria-selected` to indicate the selected date.

## Browser Support

The Date Picker component works in all modern browsers:

- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Edge (latest)

## Best Practices

1. **Provide Clear Labels**: Always use labels or aria-labels to identify what the date picker is for.
2. **Set Appropriate Constraints**: Use min-date, max-date and disabled dates to limit selections to reasonable ranges.
3. **Consider Mobile Users**: Test the component on mobile devices to ensure usability on touch screens.
4. **Localize Appropriately**: Set the locale attribute to match your user's language and regional preferences.
5. **Handle Validation**: Implement form validation to ensure selected dates meet your requirements.
6. **Explain Disabled Dates**: When disabling dates, provide clear feedback to users about why certain dates are unavailable.
7. **Use Range Selection Wisely**: When using range selection, process the available dates instead of all dates in the range.

## Common Use Cases

### Holiday Booking System

```javascript
const datePicker = document.querySelector('odyssey-date-picker[mode="range"]');

// Disable past dates
datePicker.stateService.minDate = new Date();

// Disable weekends for a business booking system
datePicker.disableWeekdays([0, 6]);

// Mark public holidays as unavailable
const holidays = getPublicHolidays(); // Your function to fetch holidays
datePicker.addDisabledDates(holidays, "Public Holiday");

// Listen for selection
datePicker.addEventListener('date-change', (event) => {
  // Use only the available business days
  const businessDays = event.detail.availableDatesObjects;
  // Calculate price based on number of business days
  calculatePrice(businessDays.length);
});
```

### Date Range with Business Days Counter

```javascript
const datePicker = document.querySelector('odyssey-date-picker[mode="range"]');
const businessDaysOutput = document.getElementById('business-days-count');

// Disable weekends
datePicker.disableWeekdays([0, 6]);

datePicker.addEventListener('date-change', (event) => {
  if (event.detail.rangeStart && event.detail.rangeEnd) {
    const businessDays = event.detail.availableDatesObjects.length;
    businessDaysOutput.textContent = `Selected ${businessDays} business days`;
  }
});
```

## Limitations

- The date picker does not support time selection.
- Mobile experience may vary based on device and browser.
- When a large number of dates are disabled, performance may be affected.
- Overlapping disabled date rules follow the hierarchy described above.