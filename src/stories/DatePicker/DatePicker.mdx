import { Meta, Story, Canvas, ArgsTable, Source } from '@storybook/addon-docs';
import DatePickerStories, { Default, Disabled, Required, RangeSelection, WithDateRange, FrenchLocale, MondayStart, DarkTheme, WithEvents, CustomStyled, CustomFormats } from './DatePicker.stories';

<Meta 
  title="Components/Date Picker/Documentation"
  of={DatePickerStories}
  parameters={{
    viewMode: 'docs',
    previewTabs: { 
      canvas: { hidden: true } 
    }
  }}
/>

# Date Picker

<div className="tip-wrapper">
  <span className="tip">Component Status: Stable</span>
</div>

A flexible and customizable date picker component for modern web applications.

## Overview

The Date Picker provides an intuitive and feature-rich interface for date selection. It supports single date selection, date range selection, localization, theming, event indicators, and custom input elements to fit various use cases.

### Key Features

- **Single and Range Selection**: Select either a single date or a date range.
- **Direct Text Input**: Type dates directly into the input field in the configured format.
- **Custom Calendar Triggering**: Hide the built-in calendar icon and use your own custom trigger elements.
- **Date Restrictions**: Disable specific dates, weekdays, or entire months.
- **Public Holidays**: Mark holidays or unavailable dates programmatically.
- **Range Selection with Available Dates**: Get a list of valid dates in a range, excluding disabled ones.
- **Localization**: Support for multiple languages and regional date formats.
- **Customizable Styling**: Extensive theming capabilities via CSS custom properties.
- **Responsive Design**: Works well on both desktop and mobile devices.
- **Keyboard Accessibility**: Full keyboard navigation support.
- **Event Indicators**: Display event indicators on specific dates.
- **Month and Year Navigation**: Easily navigate between months and years.
- **Slotable Input**: Use custom input elements while maintaining calendar functionality.

## Installation

```bash
npm install @jmkcoder/components
```

## Framework Integration

### Plain HTML

Using the component in plain HTML is straightforward:

```html
<odyssey-date-picker></odyssey-date-picker>
```

### With Date Value

```html
<odyssey-date-picker value="2025-04-22"></odyssey-date-picker>
```

### Date Range Selection

```html
<odyssey-date-picker mode="range" start-date="2025-04-15" end-date="2025-04-22"></odyssey-date-picker>
```

### With Direct Text Input

Allow users to type dates directly into the input field:

```html
<!-- The input is no longer readonly by default -->
<odyssey-date-picker format="MM/dd/yyyy"></odyssey-date-picker>
```

### With Custom Trigger Button

Hide the default calendar icon and use your own trigger element:

```html
<div class="my-date-picker-container">
  <odyssey-date-picker id="my-date-picker" show-icon="false"></odyssey-date-picker>
  <button id="open-calendar-btn" class="custom-calendar-button">ðŸ“… Open Calendar</button>
</div>

<script>
  document.getElementById('open-calendar-btn').addEventListener('click', () => {
    document.getElementById('my-date-picker').toggleCalendar();
  });
</script>
```

### With Custom Input Element

You can provide your own input element while maintaining the date picker functionality:

```html
<odyssey-date-picker>
  <input type="text" slot="input" class="my-custom-input" placeholder="Select a date">
</odyssey-date-picker>
```

## Examples

### Default Date Picker

A basic date picker with default settings.

<Canvas of={Default} />

### Disabled State

A date picker in a disabled state that doesn't allow user interaction.

<Canvas of={Disabled} />

### Required Field

A date picker marked as a required field.

<Canvas of={Required} />

### Range Selection Mode

Select a date range with start and end dates.

<Canvas of={RangeSelection} />

### With Date Range Limits

A date picker with minimum and maximum selectable dates.

<Canvas of={WithDateRange} />

### French Locale

Date picker with French locale for internationalization.

<Canvas of={FrenchLocale} />

### Week Starting on Monday

Date picker with the week starting on Monday instead of Sunday.

<Canvas of={MondayStart} />

### Dark Theme

Date picker with a dark color theme.

<Canvas of={DarkTheme} />

### With Events

Date picker showing event indicators on specific dates.

<Canvas of={WithEvents} />

### Custom Styled

A date picker with custom styling applied through CSS custom properties.

<Canvas of={CustomStyled} />

### Custom Date Formatting

Use the `format` attribute to customize how dates are displayed in the input field. Try different formats using the controls in the example below.

<Canvas of={CustomFormats} />

> **Tip**: Use the format dropdown in the Controls panel below the example to test different date formats.

## Date Formatting

The Date Picker component provides flexible date formatting options to display dates according to your application's needs or regional preferences.

### Format Patterns

You can customize the date display format by setting the `format` attribute with a pattern string:

```html
<odyssey-date-picker format="MM/dd/yyyy"></odyssey-date-picker>
```

### Format Pattern Tokens

| Token | Description | Example |
|-------|-------------|---------|
| `yyyy` | Full year (4 digits) | 2025 |
| `yy` | Short year (2 digits) | 25 |
| `MM` | Month with leading zero (01-12) | 04 |
| `M` | Month without leading zero (1-12) | 4 |
| `dd` | Day with leading zero (01-31) | 07 |
| `d` | Day without leading zero (1-31) | 7 |
| `EEE` | Short weekday name (locale-dependent) | Mon |
| `EEEE` | Full weekday name (locale-dependent) | Monday |
| `MMM` | Short month name (locale-dependent) | Apr |
| `MMMM` | Full month name (locale-dependent) | April |

### Common Date Formats

Here are some common date formats you can use:

| Format Pattern | Description | Example Output |
|----------------|-------------|----------------|
| `yyyy-MM-dd` | ISO date format (default) | 2025-04-26 |
| `MM/dd/yyyy` | US date format | 04/26/2025 |
| `dd.MM.yyyy` | European date format | 26.04.2025 |
| `dd/MM/yyyy` | UK date format | 26/04/2025 |
| `d MMMM, yyyy` | Long date format | 26 April, 2025 |
| `EEE, MMM d, yyyy` | Weekday format | Sat, Apr 26, 2025 |

### Format and Locale Interaction

When both `format` and `locale` attributes are set, the component will:

1. Use the format pattern for the input field display
2. Use locale-specific names for months and weekdays in the calendar
3. Format relative dates (like "Today") according to the locale

```html
<odyssey-date-picker 
  format="d MMMM, yyyy" 
  locale="fr-FR" 
  value="2025-04-26"
></odyssey-date-picker>
```

This will display "26 avril, 2025" using French month names while maintaining the specified format pattern.

### Programmatic Formatting

You can also format dates programmatically:

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Format a specific date with a custom format
const formattedDate = datePicker.formatDate(new Date(2025, 3, 26), 'EEE, MMM d');
console.log(formattedDate); // "Sat, Apr 26"
```

### Range Formatting

In range mode, the component uses the specified format for both dates with a separator:

```html
<odyssey-date-picker 
  mode="range" 
  format="MM/dd/yyyy"
  start-date="2025-04-15" 
  end-date="2025-04-26"
></odyssey-date-picker>
```

This will display "04/15/2025 - 04/26/2025" in the input field.

## JavaScript API

### Getting the Selected Date

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
const selectedDate = datePicker.getDate();
console.log(selectedDate); // Returns a Date object or null if no date is selected
```

### Setting a Date Programmatically

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Set date to April 22, 2025
datePicker.setDate(new Date(2025, 3, 22)); // Note: Months are zero-based (0 = January)
```

### Working with Date Ranges

```javascript
const datePicker = document.querySelector('odyssey-date-picker[mode="range"]');
// Get the selected range
const dateRange = datePicker.getDateRange();
console.log(dateRange.startDate, dateRange.endDate);

// Set a date range programmatically
datePicker.setDateRange(
  new Date(2025, 3, 15), // April 15, 2025
  new Date(2025, 3, 22)  // April 22, 2025
);

// Get all available dates in the range (excluding disabled dates)
const availableDates = datePicker.getAvailableDatesInRange();
console.log(`Available dates in range: ${availableDates.length}`);
```

### Adding Event Indicators

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Add an event indicator to April 15, 2025
datePicker.addEvent(new Date(2025, 3, 15), 'Meeting');

// Add multiple events
datePicker.addEvent(new Date(2025, 3, 22), 'Deadline');
datePicker.addEvent(new Date(2025, 3, 22), 'Team Lunch');

// Clear events from a date
datePicker.clearEvents(new Date(2025, 3, 15));
```

### Managing Disabled Dates

```javascript
const datePicker = document.querySelector('odyssey-date-picker');

// Disable specific dates (like public holidays)
datePicker.addDisabledDate(new Date(2025, 11, 25), "Christmas Day");
datePicker.addDisabledDate(new Date(2025, 0, 1), "New Year's Day");

// Disable multiple dates at once
const holidays = [
  new Date(2025, 6, 4),   // Independence Day
  new Date(2025, 10, 27), // Thanksgiving
  new Date(2025, 10, 28)  // Day after Thanksgiving
];
datePicker.addDisabledDates(holidays, "Public Holiday");

// Enable a previously disabled date
datePicker.removeDisabledDate(new Date(2025, 10, 28));

// Clear all disabled dates
datePicker.clearDisabledDates();

// Check if a date is disabled
if (datePicker.isDateDisabled(new Date(2025, 11, 25))) {
  console.log("This date is disabled");
}

// Get the reason a date is disabled
const reason = datePicker.getDisabledDateReason(new Date(2025, 11, 25));
console.log(reason); // "Christmas Day"
```

### Disabling Weekdays

```javascript
const datePicker = document.querySelector('odyssey-date-picker');

// Disable weekends (0 = Sunday, 6 = Saturday)
datePicker.disableWeekdays([0, 6]);

// Disable a specific weekday
datePicker.disableWeekday(1); // Disable Mondays

// Enable a previously disabled weekday
datePicker.enableWeekday(0); // Enable Sundays

// Clear all disabled weekdays
datePicker.clearDisabledWeekdays();

// Check if a weekday is disabled
if (datePicker.isWeekdayDisabled(6)) {
  console.log("Saturdays are disabled");
}

// Get all disabled weekdays
const disabledWeekdays = datePicker.getDisabledWeekdays();
console.log(disabledWeekdays); // e.g., [0, 6]
```

### Disabling Months

```javascript
const datePicker = document.querySelector('odyssey-date-picker');

// Disable summer months (June, July, August)
datePicker.disableMonths([5, 6, 7]); // Note: Months are zero-based (0 = January)

// Disable a specific month
datePicker.disableMonth(11); // Disable December

// Enable a previously disabled month
datePicker.enableMonth(5); // Enable June

// Clear all disabled months
datePicker.clearDisabledMonths();

// Check if a month is disabled
if (datePicker.isMonthDisabled(11)) {
  console.log("December is disabled");
}

// Get all disabled months
const disabledMonths = datePicker.getDisabledMonths();
console.log(disabledMonths); // e.g., [5, 6, 7]
```

### Listening for Date Selection Events

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
datePicker.addEventListener('date-change', (event) => {
  console.log('Selected date:', event.detail.date);
});

// For range mode
const rangePicker = document.querySelector('odyssey-date-picker[mode="range"]');
rangePicker.addEventListener('date-change', (event) => {
  console.log('Range start:', event.detail.rangeStart);
  console.log('Range end:', event.detail.rangeEnd);
  
  // Access the available dates in the range (excluding disabled dates)
  console.log('Available dates in range:', event.detail.availableDates);
  
  // Access the available dates as Date objects
  const dateObjects = event.detail.availableDatesObjects;
  console.log(`Number of available dates: ${dateObjects.length}`);
  
  // Process only the valid dates in the range
  dateObjects.forEach(date => {
    // Do something with each available date
    processDate(date);
  });
});
```

## API Reference

### Attributes/Properties

| Property/Attribute    | Type            | Default       | Description                                             |
|-----------------------|-----------------|---------------|---------------------------------------------------------|
| `value`               | `string`        | `''`          | Selected date in ISO format (YYYY-MM-DD)                |
| `mode`                | `string`        | `'single'`    | Selection mode ('single' or 'range')                    |
| `disabled`            | `boolean`       | `false`       | Disables the date picker                                |
| `required`            | `boolean`       | `false`       | Makes the date picker a required field                  |
| `format`              | `string`        | `'yyyy-MM-dd'`| Date format for display                                 |
| `min-date`            | `string`        | `''`          | Minimum selectable date in ISO format                   |
| `max-date`            | `string`        | `''`          | Maximum selectable date in ISO format                   |
| `start-date`          | `string`        | `''`          | Start date for range selection in ISO format            |
| `end-date`            | `string`        | `''`          | End date for range selection in ISO format              |
| `locale`              | `string`        | `'en-US'`     | Locale for date formatting and localization             |
| `first-day-of-week`   | `string`        | `'0'`         | First day of week (0: Sunday, 1: Monday, 6: Saturday)   |
| `theme`               | `string`        | `'light'`     | Theme variant ('light', 'dark', 'minimal', 'high-contrast') |
| `show-icon`           | `boolean`       | `true`        | Controls visibility of the calendar icon                |

### Slots

| Slot Name    | Description                                                                     |
|--------------|---------------------------------------------------------------------------------|
| `input`      | Slot for a custom input element (replaces the default input while maintaining the calendar icon and functionality) |

### Methods

| Method                 | Parameters                                    | Return Type    | Description                               |
|------------------------|-----------------------------------------------|----------------|-------------------------------------------|
| `setDate(date)`        | `date: Date`                                  | `void`         | Sets the selected date                     |
| `getDate()`            | -                                             | `Date \| null` | Gets the selected date                     |
| `setDateRange(startDate, endDate)` | `startDate: Date, endDate: Date`  | `void`         | Sets the selected date range               |
| `getDateRange()`       | -                                             | `{startDate: Date \| null, endDate: Date \| null}` | Gets the selected date range |
| `getAvailableDatesInRange()` | -                                       | `Date[]`       | Gets available dates within the selected range, excluding disabled dates |
| `toggleCalendar()`     | -                                             | `void`         | Programmatically open or close the calendar popup |
| `addEvent(date, eventName)`      | `date: Date, eventName: string = 'event'` | `void`  | Adds an event indicator to a specific date |
| `clearEvents(date)`    | `date: Date`                                  | `void`         | Clears event indicators from a specific date |
| `addDisabledDate(date, reason)` | `date: Date, reason?: string` | `void` | Disables a specific date with optional reason |
| `removeDisabledDate(date)` | `date: Date` | `void` | Enables a previously disabled date |
| `addDisabledDates(dates, reason)` | `dates: Date[], reason?: string` | `void` | Disables multiple dates at once with optional shared reason |
| `clearDisabledDates()` | - | `void` | Clears all specifically disabled dates |
| `isDateDisabled(date)` | `date: Date` | `boolean` | Checks if a date is disabled |
| `getDisabledDateReason(date)` | `date: Date` | `string \| null` | Gets the reason a date is disabled or null if not disabled |
| `disableWeekday(weekday)` | `weekday: number` | `void` | Disables a specific weekday (0-6) |
| `enableWeekday(weekday)` | `weekday: number` | `void` | Enables a previously disabled weekday |
| `disableWeekdays(weekdays)` | `weekdays: number[]` | `void` | Disables multiple weekdays at once |
| `clearDisabledWeekdays()` | - | `void` | Clears all disabled weekday settings |
| `isWeekdayDisabled(weekday)` | `weekday: number` | `boolean` | Checks if a weekday is disabled |
| `getDisabledWeekdays()` | - | `number[]` | Gets all currently disabled weekdays |
| `disableMonth(month)` | `month: number` | `void` | Disables a specific month (0-11) |
| `enableMonth(month)` | `month: number` | `void` | Enables a previously disabled month |
| `disableMonths(months)` | `months: number[]` | `void` | Disables multiple months at once |
| `clearDisabledMonths()` | - | `void` | Clears all disabled month settings |
| `isMonthDisabled(month)` | `month: number` | `boolean` | Checks if a month is disabled |
| `getDisabledMonths()` | - | `number[]` | Gets all currently disabled months |

### Events

| Event Name         | Detail Object                                      | Description                                  |
|--------------------|---------------------------------------------------|----------------------------------------------|
| `date-change`      | Single mode: `{date: string}`<br/>Range mode: `{rangeStart: string, rangeEnd: string, availableDates: string[], availableDatesObjects: Date[]}` | Fired when the selected date changes. Range mode includes arrays of available dates (excluding disabled ones) |
| `calendar-open`    | `{}`                                              | Fired when the calendar is opened             |
| `calendar-close`   | `{}`                                              | Fired when the calendar is closed             |
| `date-clear`       | `{}`                                              | Fired when the date selection is cleared      |

### CSS Custom Properties

| Property                              | Default              | Description                                    |
|---------------------------------------|----------------------|------------------------------------------------|
| `--date-picker-primary-color`         | `#4361ee`            | Primary color for selected dates and actions   |
| `--date-picker-text-color`            | `#333`               | Text color                                     |
| `--date-picker-bg-color`              | `#fff`               | Background color                               |
| `--date-picker-border-color`          | `#ddd`               | Border color                                   |
| `--date-picker-today-bg-color`        | `#f0f4ff`            | Background color for today's date             |
| `--date-picker-selected-bg-color`     | `#4361ee`            | Background color for selected date            |
| `--date-picker-selected-text-color`   | `#fff`               | Text color for selected date                  |
| `--date-picker-hover-bg-color`        | `#f5f7fa`            | Background color on hover                     |
| `--date-picker-disabled-text-color`   | `#bbb`               | Text color for disabled dates                 |
| `--date-picker-event-color`           | `#ff6b6b`            | Color for event indicators                    |
| `--date-picker-focus-outline-color`   | `#4361ee`            | Color for focus outline                       |
| `--date-picker-range-bg-color`        | Variable opacity     | Background color for date range               |

## Direct Text Input

The Date Picker component now supports direct text input, allowing users to type dates directly in the configured format instead of only selecting from the calendar.

### Using Direct Text Input

By default, all DatePicker inputs allow text input in the configured format. When a user types a date and then:
- Tabs away (blur event)
- Presses Enter
- Clicks outside the input

The entered date is validated against the configured format pattern. If valid, it's accepted and the calendar view updates accordingly. If invalid, it reverts to the previous valid date or clears if no previous date was selected.

### Example with Custom Format

```html
<odyssey-date-picker 
  format="MM/dd/yyyy"
  placeholder="Enter a date (mm/dd/yyyy)">
</odyssey-date-picker>
```

In this example, users can either:
1. Click the calendar icon to open the date picker and select a date
2. Type a date directly in MM/dd/yyyy format (e.g., "04/26/2025")

### Range Input

When in range mode, users can type a date range using the format pattern with a separator:

```html
<odyssey-date-picker 
  mode="range"
  format="MM/dd/yyyy">
</odyssey-date-picker>
```

Users can then type a range like "04/15/2025 - 04/26/2025" and it will be parsed correctly.

### Validation

The component performs validation when the input loses focus or when Enter is pressed:
- Validates the entered text against the configured date format
- If valid, updates the internal date state
- If invalid, restores the previous valid date (or clears if no previous date)

### Keyboard Support

Direct text input works seamlessly with keyboard navigation:
- Tab: Move to the next form element
- Shift+Tab: Move to the previous form element
- Enter: Commit the entered date
- Escape: Close the calendar if open

## Custom Calendar Triggering

The Date Picker component now allows you to hide the default calendar icon and use your own custom elements to trigger the calendar. This gives you complete control over the visual presentation while still leveraging all the calendar functionality.

### Hiding the Default Calendar Icon

Use the `show-icon` attribute to control the visibility of the default calendar icon:

```html
<!-- Hide the default calendar icon -->
<odyssey-date-picker show-icon="false"></odyssey-date-picker>
```

### Using a Custom Trigger

You can create any custom button or element to open/close the calendar:

```html
<div class="custom-date-container">
  <odyssey-date-picker id="custom-trigger-picker" show-icon="false"></odyssey-date-picker>
  <button id="custom-calendar-button" class="fancy-calendar-button">
    <svg><!-- Your custom calendar icon SVG --></svg>
    Select Date
  </button>
</div>

<script>
  document.getElementById('custom-calendar-button').addEventListener('click', () => {
    // Use the public toggleCalendar method
    document.getElementById('custom-trigger-picker').toggleCalendar();
  });
</script>
```

### Integration with Design Systems

This feature makes it easy to integrate the DatePicker with various design systems and UI frameworks:

```html
<!-- Example with a Material Design style button -->
<div class="date-field-container">
  <odyssey-date-picker id="material-date-picker" show-icon="false"></odyssey-date-picker>
  <button class="md-button" onclick="document.getElementById('material-date-picker').toggleCalendar()">
    <i class="material-icons">calendar_today</i>
  </button>
</div>
```

### Advanced Custom Triggers

You can create more complex trigger behaviors:

```javascript
// Get references to the elements
const datePicker = document.getElementById('advanced-picker');
const openButton = document.getElementById('open-calendar');
const closeButton = document.getElementById('close-calendar');
const toggleButton = document.getElementById('toggle-calendar');

// Open the calendar
openButton.addEventListener('click', () => {
  datePicker.stateService.isOpen = true;
});

// Close the calendar
closeButton.addEventListener('click', () => {
  datePicker.stateService.isOpen = false;
});

// Toggle calendar visibility
toggleButton.addEventListener('click', () => {
  datePicker.toggleCalendar();
});

// Listen for calendar open/close events
datePicker.addEventListener('calendar-open', () => {
  console.log('Calendar opened');
  // You can update your custom UI here
});

datePicker.addEventListener('calendar-close', () => {
  console.log('Calendar closed');
  // You can update your custom UI here
});
```

This new functionality makes the DatePicker component incredibly flexible and easy to integrate into any UI design system or framework.