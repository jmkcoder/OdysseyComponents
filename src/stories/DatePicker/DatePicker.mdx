import { Meta, Story, Canvas, ArgsTable, Source } from '@storybook/addon-docs';
import DatePickerStories, { Default, Disabled, Required, RangeSelection, WithDateRange, FrenchLocale, MondayStart, DarkTheme, WithEvents, CustomStyled, CustomFormats } from './DatePicker.stories';

<Meta 
  title="Components/Date Picker/Documentation"
  of={DatePickerStories}
  parameters={{
    viewMode: 'docs',
    previewTabs: { 
      canvas: { hidden: true } 
    }
  }}
/>

# Date Picker

<div className="tip-wrapper">
  <span className="tip">Component Status: Stable</span>
</div>

A flexible and customizable date picker component for modern web applications.

## Overview

The Date Picker provides an intuitive and feature-rich interface for date selection. It supports single date selection, date range selection, localization, theming, and event indicators to fit various use cases.

### Key Features

- **Single and Range Selection**: Select either a single date or a date range.
- **Localization**: Support for multiple languages and regional date formats.
- **Customizable Styling**: Extensive theming capabilities via CSS custom properties.
- **Responsive Design**: Works well on both desktop and mobile devices.
- **Keyboard Accessibility**: Full keyboard navigation support.
- **Event Indicators**: Display event indicators on specific dates.
- **Month and Year Navigation**: Easily navigate between months and years.

## Installation

```bash
npm install @jmkcoder/components
```

## Framework Integration

### Plain HTML

Using the component in plain HTML is straightforward:

```html
<odyssey-date-picker></odyssey-date-picker>
```

### With Date Value

```html
<odyssey-date-picker value="2025-04-22"></odyssey-date-picker>
```

### Date Range Selection

```html
<odyssey-date-picker mode="range" start-date="2025-04-15" end-date="2025-04-22"></odyssey-date-picker>
```

## Examples

### Default Date Picker

A basic date picker with default settings.

<Canvas of={Default} />

### Disabled State

A date picker in a disabled state that doesn't allow user interaction.

<Canvas of={Disabled} />

### Required Field

A date picker marked as a required field.

<Canvas of={Required} />

### Range Selection Mode

Select a date range with start and end dates.

<Canvas of={RangeSelection} />

### With Date Range Limits

A date picker with minimum and maximum selectable dates.

<Canvas of={WithDateRange} />

### French Locale

Date picker with French locale for internationalization.

<Canvas of={FrenchLocale} />

### Week Starting on Monday

Date picker with the week starting on Monday instead of Sunday.

<Canvas of={MondayStart} />

### Dark Theme

Date picker with a dark color theme.

<Canvas of={DarkTheme} />

### With Events

Date picker showing event indicators on specific dates.

<Canvas of={WithEvents} />

### Custom Styled

A date picker with custom styling applied through CSS custom properties.

<Canvas of={CustomStyled} />

### Custom Date Formatting

Use the `format` attribute to customize how dates are displayed in the input field. Try different formats using the controls in the example below.

<Canvas of={CustomFormats} />

> **Tip**: Use the format dropdown in the Controls panel below the example to test different date formats.

## Date Formatting

The Date Picker component provides flexible date formatting options to display dates according to your application's needs or regional preferences.

### Format Patterns

You can customize the date display format by setting the `format` attribute with a pattern string:

```html
<odyssey-date-picker format="MM/dd/yyyy"></odyssey-date-picker>
```

### Format Pattern Tokens

| Token | Description | Example |
|-------|-------------|---------|
| `yyyy` | Full year (4 digits) | 2025 |
| `yy` | Short year (2 digits) | 25 |
| `MM` | Month with leading zero (01-12) | 04 |
| `M` | Month without leading zero (1-12) | 4 |
| `dd` | Day with leading zero (01-31) | 07 |
| `d` | Day without leading zero (1-31) | 7 |
| `EEE` | Short weekday name (locale-dependent) | Mon |
| `EEEE` | Full weekday name (locale-dependent) | Monday |
| `MMM` | Short month name (locale-dependent) | Apr |
| `MMMM` | Full month name (locale-dependent) | April |

### Common Date Formats

Here are some common date formats you can use:

| Format Pattern | Description | Example Output |
|----------------|-------------|----------------|
| `yyyy-MM-dd` | ISO date format (default) | 2025-04-26 |
| `MM/dd/yyyy` | US date format | 04/26/2025 |
| `dd.MM.yyyy` | European date format | 26.04.2025 |
| `dd/MM/yyyy` | UK date format | 26/04/2025 |
| `d MMMM, yyyy` | Long date format | 26 April, 2025 |
| `EEE, MMM d, yyyy` | Weekday format | Sat, Apr 26, 2025 |

### Format and Locale Interaction

When both `format` and `locale` attributes are set, the component will:

1. Use the format pattern for the input field display
2. Use locale-specific names for months and weekdays in the calendar
3. Format relative dates (like "Today") according to the locale

```html
<odyssey-date-picker 
  format="d MMMM, yyyy" 
  locale="fr-FR" 
  value="2025-04-26"
></odyssey-date-picker>
```

This will display "26 avril, 2025" using French month names while maintaining the specified format pattern.

### Programmatic Formatting

You can also format dates programmatically:

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Format a specific date with a custom format
const formattedDate = datePicker.formatDate(new Date(2025, 3, 26), 'EEE, MMM d');
console.log(formattedDate); // "Sat, Apr 26"
```

### Range Formatting

In range mode, the component uses the specified format for both dates with a separator:

```html
<odyssey-date-picker 
  mode="range" 
  format="MM/dd/yyyy"
  start-date="2025-04-15" 
  end-date="2025-04-26"
></odyssey-date-picker>
```

This will display "04/15/2025 - 04/26/2025" in the input field.

## JavaScript API

### Getting the Selected Date

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
const selectedDate = datePicker.getDate();
console.log(selectedDate); // Returns a Date object or null if no date is selected
```

### Setting a Date Programmatically

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Set date to April 22, 2025
datePicker.setDate(new Date(2025, 3, 22)); // Note: Months are zero-based (0 = January)
```

### Working with Date Ranges

```javascript
const datePicker = document.querySelector('odyssey-date-picker[mode="range"]');
// Get the selected range
const dateRange = datePicker.getDateRange();
console.log(dateRange.startDate, dateRange.endDate);

// Set a date range programmatically
datePicker.setDateRange(
  new Date(2025, 3, 15), // April 15, 2025
  new Date(2025, 3, 22)  // April 22, 2025
);
```

### Adding Event Indicators

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
// Add an event indicator to April 15, 2025
datePicker.addEvent(new Date(2025, 3, 15), 'Meeting');

// Add multiple events
datePicker.addEvent(new Date(2025, 3, 22), 'Deadline');
datePicker.addEvent(new Date(2025, 3, 22), 'Team Lunch');

// Clear events from a date
datePicker.clearEvents(new Date(2025, 3, 15));
```

### Listening for Date Selection Events

```javascript
const datePicker = document.querySelector('odyssey-date-picker');
datePicker.addEventListener('date-change', (event) => {
  console.log('Selected date:', event.detail.date);
});

// For range mode
const rangePickerr = document.querySelector('odyssey-date-picker[mode="range"]');
rangePickerr.addEventListener('date-change', (event) => {
  console.log('Range start:', event.detail.rangeStart);
  console.log('Range end:', event.detail.rangeEnd);
});
```

## API Reference

### Attributes/Properties

| Property/Attribute    | Type            | Default       | Description                                             |
|-----------------------|-----------------|---------------|---------------------------------------------------------|
| `value`               | `string`        | `''`          | Selected date in ISO format (YYYY-MM-DD)                |
| `mode`                | `string`        | `'single'`    | Selection mode ('single' or 'range')                    |
| `disabled`            | `boolean`       | `false`       | Disables the date picker                                |
| `required`            | `boolean`       | `false`       | Makes the date picker a required field                  |
| `format`              | `string`        | `'yyyy-MM-dd'`| Date format for display                                 |
| `min-date`            | `string`        | `''`          | Minimum selectable date in ISO format                   |
| `max-date`            | `string`        | `''`          | Maximum selectable date in ISO format                   |
| `start-date`          | `string`        | `''`          | Start date for range selection in ISO format            |
| `end-date`            | `string`        | `''`          | End date for range selection in ISO format              |
| `locale`              | `string`        | `'en-US'`     | Locale for date formatting and localization             |
| `first-day-of-week`   | `string`        | `'0'`         | First day of week (0: Sunday, 1: Monday, 6: Saturday)   |
| `theme`               | `string`        | `'light'`     | Theme variant ('light', 'dark', 'minimal', 'high-contrast') |

### Methods

| Method                 | Parameters                                    | Return Type    | Description                               |
|------------------------|-----------------------------------------------|----------------|-------------------------------------------|
| `setDate(date)`        | `date: Date`                                  | `void`         | Sets the selected date                     |
| `getDate()`            | -                                             | `Date \| null` | Gets the selected date                     |
| `setDateRange(startDate, endDate)` | `startDate: Date, endDate: Date`  | `void`         | Sets the selected date range               |
| `getDateRange()`       | -                                             | `{startDate: Date \| null, endDate: Date \| null}` | Gets the selected date range |
| `addEvent(date, eventName)`      | `date: Date, eventName: string = 'event'` | `void`  | Adds an event indicator to a specific date |
| `clearEvents(date)`    | `date: Date`                                  | `void`         | Clears event indicators from a specific date |

### Events

| Event Name         | Detail Object                                      | Description                                  |
|--------------------|---------------------------------------------------|----------------------------------------------|
| `date-change`      | `{date: string} \| {rangeStart: string, rangeEnd: string}` | Fired when the selected date changes         |
| `calendar-open`    | `{}`                                              | Fired when the calendar is opened             |
| `calendar-close`   | `{}`                                              | Fired when the calendar is closed             |

### CSS Custom Properties

| Property                              | Default              | Description                                    |
|---------------------------------------|----------------------|------------------------------------------------|
| `--date-picker-primary-color`         | `#4361ee`            | Primary color for selected dates and actions   |
| `--date-picker-text-color`            | `#333`               | Text color                                     |
| `--date-picker-bg-color`              | `#fff`               | Background color                               |
| `--date-picker-border-color`          | `#ddd`               | Border color                                   |
| `--date-picker-today-bg-color`        | `#f0f4ff`            | Background color for today's date             |
| `--date-picker-selected-bg-color`     | `#4361ee`            | Background color for selected date            |
| `--date-picker-selected-text-color`   | `#fff`               | Text color for selected date                  |
| `--date-picker-hover-bg-color`        | `#f5f7fa`            | Background color on hover                     |
| `--date-picker-disabled-text-color`   | `#bbb`               | Text color for disabled dates                 |
| `--date-picker-event-color`           | `#ff6b6b`            | Color for event indicators                    |
| `--date-picker-focus-outline-color`   | `#4361ee`            | Color for focus outline                       |
| `--date-picker-range-bg-color`        | Variable opacity     | Background color for date range               |

## Accessibility

The Date Picker component is built with accessibility in mind, supporting ARIA attributes and keyboard navigation.

### Keyboard Navigation

- **Tab**: Focus on the date picker input field.
- **Space/Enter**: Open the calendar when input is focused.
- **Arrow keys**: Navigate within the calendar grid.
- **Page Up/Down**: Navigate to previous/next month.
- **Home/End**: Navigate to the first/last day of the current month.
- **Escape**: Close the calendar without selection.
- **Enter**: Select the focused date.

### ARIA Attributes

- `role="dialog"` for the calendar popup.
- `aria-label` attributes for navigation buttons.
- `aria-selected` to indicate the selected date.

## Browser Support

The Date Picker component works in all modern browsers:

- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Edge (latest)

## Best Practices

1. **Provide Clear Labels**: Always use labels or aria-labels to identify what the date picker is for.
2. **Set Appropriate Constraints**: Use min-date and max-date attributes to limit selections to reasonable ranges.
3. **Consider Mobile Users**: Test the component on mobile devices to ensure usability on touch screens.
4. **Localize Appropriately**: Set the locale attribute to match your user's language and regional preferences.
5. **Handle Validation**: Implement form validation to ensure selected dates meet your requirements.

## Limitations

- The date picker does not support time selection.
- Mobile experience may vary based on device and browser.